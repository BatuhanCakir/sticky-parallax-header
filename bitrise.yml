---
format_version: '11'
default_step_lib_source: 'https://github.com/bitrise-io/bitrise-steplib.git'
project_type: react-native
meta:
  bitrise.io:
    stack: osx-xcode-13.2.x
app:
  envs:
  - opts:
      is_expand: false
    PLATFORM: all
trigger_map:
- pull_request_source_branch: '*'
  pull_request_target_branch: master
  workflow: lint
workflows:
  # deploy:
  #   description: >
  #     Tests the app and runs a build on Expo Application Services (EAS).


  #     Next steps:

  #     - Configure the `Run Expo Application Services (EAS) build` Step's `Access
  #     Token` input.

  #     - Check out [Getting started with Expo
  #     apps](https://devcenter.bitrise.io/en/getting-started/getting-started-with-expo-apps.html).

  #     - For an alternative deploy workflow checkout the [(React Native) Expo:
  #     Build using Turtle CLI
  #     recipe](https://github.com/bitrise-io/workflow-recipes/blob/main/recipes/rn-expo-turtle-build.md).
  #   steps:
  #   - activate-ssh-key@4: {}
  #   - git-clone@6: {}
  #   - yarn@0:
  #       inputs:
  #       - workdir: example
  #       - command: install
  #   - yarn@0:
  #       inputs:
  #       - workdir: example
  #       - command: test
  #   - run-eas-build@0:
  #       inputs:
  #       - platform: $PLATFORM
  #       - work_dir: example
  #   - deploy-to-bitrise-io@2: {}
  # primary:
  #   description: >
  #     Runs tests.


  #     Next steps:

  #     - Check out [Getting started with Expo
  #     apps](https://devcenter.bitrise.io/en/getting-started/getting-started-with-expo-apps.html).
  #   steps:
  #   - activate-ssh-key@4: {}
  #   - git-clone@6: {}
  #   - yarn@0:
  #       inputs:
  #       - workdir: example
  #       - command: install
  #   - yarn@0:
  #       inputs:
  #       - workdir: example
  #       - command: test
  #   - deploy-to-bitrise-io@2: {}
  lint:
    description: >
      Run ESLint & TypeScript
    steps:
    - activate-ssh-key@4: {}
    - git-clone@6: {}
    - cache-pull@2: {}
    - yarn@0:
        inputs:
        - command: install
    - yarn@0:
        inputs:
        - command: lint
    - yarn@0:
        inputs:
        - command: typescript
    - cache-push@2:
        inputs:
          - cache_paths: |-
              $HOME/.rbenv
              ./ios/Pods
              ./node_modules
              $HOME/.gradle
              ./.gradle
          - ignore_check_on_paths: |-
              $HOME/.gradle/caches/*.lock
              ./.gradle/*.lock
              ./.gradle/*.bin
    - deploy-to-bitrise-io@2: {}
  prod_android:
    description: >
      Create Android release build
    steps:
    - activate-ssh-key@4: {}
    - git-clone@6: {}
    - cache-pull@2: {}
    - yarn@0:
        inputs:
        - workdir: example
        - command: install
    - android-build@1:
        inputs:
        - variant: release
        - build_type: apk
        - project_location: "./example/android"
    - cache-push@2:
        inputs:
          - cache_paths: |-
              $HOME/.rbenv
              ./ios/Pods
              ./node_modules
              $HOME/.gradle
              ./.gradle
          - ignore_check_on_paths: |-
              $HOME/.gradle/caches/*.lock
              ./.gradle/*.lock
              ./.gradle/*.bin
    - deploy-to-bitrise-io@2: {}
  prod_ios:
    description: >
      Create iOS release build
    steps:
    - activate-ssh-key@4: {}
    - git-clone@6: {}
    - cache-pull@2: {}
    - yarn@0:
        inputs:
        - workdir: example
        - command: install
    - cocoapods-install@2: {}
    - xcode-build-for-simulator@0:
        inputs:
          - project_path: './example/ios/reactnativestickyparallaxheaderexample.xcworkspace'
          - scheme: 'reactnativestickyparallaxheaderexamplerelease'
          - simulator_device: 'iPhone 13'
          - simulator_os_version: latest
    - cache-push@2:
        inputs:
          - cache_paths: |-
              $HOME/.rbenv
              ./ios/Pods
              ./node_modules
              $HOME/.gradle
              ./.gradle
          - ignore_check_on_paths: |-
              $HOME/.gradle/caches/*.lock
              ./.gradle/*.lock
              ./.gradle/*.bin
    - deploy-to-bitrise-io@2: {}
